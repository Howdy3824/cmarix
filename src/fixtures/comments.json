[
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/270990369",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-270990369",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 270990369,
    "user": {
      "login": "utilum",
      "id": 6261109,
      "avatar_url": "https://avatars.githubusercontent.com/u/6261109?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/utilum",
      "html_url": "https://github.com/utilum",
      "followers_url": "https://api.github.com/users/utilum/followers",
      "following_url": "https://api.github.com/users/utilum/following{/other_user}",
      "gists_url": "https://api.github.com/users/utilum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/utilum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/utilum/subscriptions",
      "organizations_url": "https://api.github.com/users/utilum/orgs",
      "repos_url": "https://api.github.com/users/utilum/repos",
      "events_url": "https://api.github.com/users/utilum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/utilum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-06T19:54:10Z",
    "updated_at": "2017-01-06T19:54:10Z",
    "body": "Can reproduce."
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/270990414",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-270990414",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 270990414,
    "user": {
      "login": "jtrost",
      "id": 1156272,
      "avatar_url": "https://avatars.githubusercontent.com/u/1156272?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtrost",
      "html_url": "https://github.com/jtrost",
      "followers_url": "https://api.github.com/users/jtrost/followers",
      "following_url": "https://api.github.com/users/jtrost/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtrost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtrost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtrost/subscriptions",
      "organizations_url": "https://api.github.com/users/jtrost/orgs",
      "repos_url": "https://api.github.com/users/jtrost/repos",
      "events_url": "https://api.github.com/users/jtrost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtrost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-06T19:54:20Z",
    "updated_at": "2017-01-06T19:54:20Z",
    "body": "One thing that stands out about your code is that the Invite class does not define the `<=>` operator. The [Comparable documentation](https://ruby-doc.org/core-2.3.3/Comparable.html) says:\r\n>The class must define the <=> operator, which compares the receiver against another object, returning -1, 0, or +1 depending on whether the receiver is less than, equal to, or greater than the other object.\r\n\r\nIt's not clear what the Invite class is comparing, however if you add this method to the class then the test will pass.\r\n````ruby\r\ndef <=>(other)\r\n  1\r\nend\r\n````"
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/270992272",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-270992272",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 270992272,
    "user": {
      "login": "jnimety",
      "id": 70484,
      "avatar_url": "https://avatars.githubusercontent.com/u/70484?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnimety",
      "html_url": "https://github.com/jnimety",
      "followers_url": "https://api.github.com/users/jnimety/followers",
      "following_url": "https://api.github.com/users/jnimety/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnimety/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnimety/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnimety/subscriptions",
      "organizations_url": "https://api.github.com/users/jnimety/orgs",
      "repos_url": "https://api.github.com/users/jnimety/repos",
      "events_url": "https://api.github.com/users/jnimety/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnimety/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-06T20:02:07Z",
    "updated_at": "2017-01-06T20:02:07Z",
    "body": "It still fails if I add a `score` column and use\r\n\r\n```\r\ndef <=>(other)\r\n  other.score <=> self.score\r\nend\r\n```"
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/270997315",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-270997315",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 270997315,
    "user": {
      "login": "alexcameron89",
      "id": 5634381,
      "avatar_url": "https://avatars.githubusercontent.com/u/5634381?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcameron89",
      "html_url": "https://github.com/alexcameron89",
      "followers_url": "https://api.github.com/users/alexcameron89/followers",
      "following_url": "https://api.github.com/users/alexcameron89/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcameron89/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcameron89/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcameron89/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcameron89/orgs",
      "repos_url": "https://api.github.com/users/alexcameron89/repos",
      "events_url": "https://api.github.com/users/alexcameron89/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcameron89/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-06T20:25:29Z",
    "updated_at": "2017-01-06T20:25:29Z",
    "body": "This looks to be fixed on master by @sgrif with 15ddd5179c746a2201b9805edf0764f515da8d7a."
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/271002157",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-271002157",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 271002157,
    "user": {
      "login": "jnimety",
      "id": 70484,
      "avatar_url": "https://avatars.githubusercontent.com/u/70484?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnimety",
      "html_url": "https://github.com/jnimety",
      "followers_url": "https://api.github.com/users/jnimety/followers",
      "following_url": "https://api.github.com/users/jnimety/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnimety/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnimety/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnimety/subscriptions",
      "organizations_url": "https://api.github.com/users/jnimety/orgs",
      "repos_url": "https://api.github.com/users/jnimety/repos",
      "events_url": "https://api.github.com/users/jnimety/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnimety/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-06T20:48:38Z",
    "updated_at": "2017-01-06T20:48:38Z",
    "body": "fantastic, thanks for looking into this."
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/271003232",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-271003232",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 271003232,
    "user": {
      "login": "sgrif",
      "id": 1529387,
      "avatar_url": "https://avatars.githubusercontent.com/u/1529387?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sgrif",
      "html_url": "https://github.com/sgrif",
      "followers_url": "https://api.github.com/users/sgrif/followers",
      "following_url": "https://api.github.com/users/sgrif/following{/other_user}",
      "gists_url": "https://api.github.com/users/sgrif/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sgrif/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sgrif/subscriptions",
      "organizations_url": "https://api.github.com/users/sgrif/orgs",
      "repos_url": "https://api.github.com/users/sgrif/repos",
      "events_url": "https://api.github.com/users/sgrif/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sgrif/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-06T20:53:26Z",
    "updated_at": "2017-01-06T20:53:26Z",
    "body": "Hm... That was committed to 5-0-stable several months before 5.0.1 was released though. I'm curious why it wasn't included."
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/271003624",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-271003624",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 271003624,
    "user": {
      "login": "sgrif",
      "id": 1529387,
      "avatar_url": "https://avatars.githubusercontent.com/u/1529387?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sgrif",
      "html_url": "https://github.com/sgrif",
      "followers_url": "https://api.github.com/users/sgrif/followers",
      "following_url": "https://api.github.com/users/sgrif/following{/other_user}",
      "gists_url": "https://api.github.com/users/sgrif/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sgrif/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sgrif/subscriptions",
      "organizations_url": "https://api.github.com/users/sgrif/orgs",
      "repos_url": "https://api.github.com/users/sgrif/repos",
      "events_url": "https://api.github.com/users/sgrif/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sgrif/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-06T20:55:26Z",
    "updated_at": "2017-01-06T20:55:26Z",
    "body": "I'm being thick. That commit was in 5.0.1. I don't think that commit fixed this issue."
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/271006988",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-271006988",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 271006988,
    "user": {
      "login": "jnimety",
      "id": 70484,
      "avatar_url": "https://avatars.githubusercontent.com/u/70484?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnimety",
      "html_url": "https://github.com/jnimety",
      "followers_url": "https://api.github.com/users/jnimety/followers",
      "following_url": "https://api.github.com/users/jnimety/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnimety/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnimety/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnimety/subscriptions",
      "organizations_url": "https://api.github.com/users/jnimety/orgs",
      "repos_url": "https://api.github.com/users/jnimety/repos",
      "events_url": "https://api.github.com/users/jnimety/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnimety/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-06T21:09:19Z",
    "updated_at": "2017-01-06T21:09:19Z",
    "body": "here's an updated test, it fails as long as the compare method returns equality (0).\r\n\r\n```\r\nbegin\r\n  require \"bundler/inline\"\r\nrescue LoadError => e\r\n  $stderr.puts \"Bundler version 1.10 or later is required. Please update your Bundler\"\r\n  raise e\r\nend\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n  gem \"activerecord\", \"5.0.1\"\r\n  #gem \"activerecord\", \"5.0.0.1\"\r\n  gem \"pg\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection adapter: \"postgresql\"\r\nActiveRecord::Base.connection.drop_database \"test_has_many_through_with_comparable\"\r\nActiveRecord::Base.connection.create_database \"test_has_many_through_with_comparable\"\r\nActiveRecord::Base.establish_connection adapter: \"postgresql\", database: \"test_has_many_through_with_comparable\"\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :events, force: true do |t|\r\n  end\r\n\r\n  create_table :invites, force: true do |t|\r\n    t.integer :event_id\r\n    t.integer :user_id\r\n  end\r\n\r\n  create_table :users, force: true do |t|\r\n  end\r\nend\r\n\r\nclass Event < ActiveRecord::Base\r\n  has_many :invites\r\n\r\n  has_many :users, :through => :invites\r\nend\r\n\r\nclass Invite < ActiveRecord::Base\r\n  include Comparable\r\n\r\n  belongs_to :event\r\n  belongs_to :user\r\n\r\n  def <=>(other)\r\n    0\r\n  end\r\nend\r\n\r\nclass User < ActiveRecord::Base\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_has_many_through_with_comparable\r\n    user1 = User.create\r\n    user2 = User.create\r\n\r\n    event = Event.create(user_ids: [user1.id, user2.id]) # Invite#event_id does not get set for user2\r\n\r\n    assert_equal event.invites.count, 2\r\n  end\r\nend\r\n```"
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/271032552",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-271032552",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 271032552,
    "user": {
      "login": "maclover7",
      "id": 3020626,
      "avatar_url": "https://avatars.githubusercontent.com/u/3020626?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maclover7",
      "html_url": "https://github.com/maclover7",
      "followers_url": "https://api.github.com/users/maclover7/followers",
      "following_url": "https://api.github.com/users/maclover7/following{/other_user}",
      "gists_url": "https://api.github.com/users/maclover7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maclover7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maclover7/subscriptions",
      "organizations_url": "https://api.github.com/users/maclover7/orgs",
      "repos_url": "https://api.github.com/users/maclover7/repos",
      "events_url": "https://api.github.com/users/maclover7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maclover7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-06T22:54:24Z",
    "updated_at": "2017-01-06T22:59:05Z",
    "body": "Marking as a regression since the tests pass on `4-2-stable`, but are failing on v5.0.1. Investigating...\r\n\r\nEDIT: Per git bisect, it looks like 15ddd5179c746a2201b9805edf0764f515da8d7a is the commit that introduces the change in behavior in Active Record."
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/271080684",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-271080684",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 271080684,
    "user": {
      "login": "kamipo",
      "id": 12642,
      "avatar_url": "https://avatars.githubusercontent.com/u/12642?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kamipo",
      "html_url": "https://github.com/kamipo",
      "followers_url": "https://api.github.com/users/kamipo/followers",
      "following_url": "https://api.github.com/users/kamipo/following{/other_user}",
      "gists_url": "https://api.github.com/users/kamipo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kamipo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kamipo/subscriptions",
      "organizations_url": "https://api.github.com/users/kamipo/orgs",
      "repos_url": "https://api.github.com/users/kamipo/repos",
      "events_url": "https://api.github.com/users/kamipo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kamipo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-07T12:25:35Z",
    "updated_at": "2017-01-07T12:25:35Z",
    "body": "Fixed in #27442 on master."
  },
  {
    "url": "https://api.github.com/repos/rails/rails/issues/comments/271083985",
    "html_url": "https://github.com/rails/rails/issues/27595#issuecomment-271083985",
    "issue_url": "https://api.github.com/repos/rails/rails/issues/27595",
    "id": 271083985,
    "user": {
      "login": "maclover7",
      "id": 3020626,
      "avatar_url": "https://avatars.githubusercontent.com/u/3020626?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maclover7",
      "html_url": "https://github.com/maclover7",
      "followers_url": "https://api.github.com/users/maclover7/followers",
      "following_url": "https://api.github.com/users/maclover7/following{/other_user}",
      "gists_url": "https://api.github.com/users/maclover7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maclover7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maclover7/subscriptions",
      "organizations_url": "https://api.github.com/users/maclover7/orgs",
      "repos_url": "https://api.github.com/users/maclover7/repos",
      "events_url": "https://api.github.com/users/maclover7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maclover7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-07T13:31:26Z",
    "updated_at": "2017-01-07T13:31:26Z",
    "body": "👍 Added `needs backport` label on that PR, so hopefully will be backported to `5-0-stable` soon by the core team."
  }
]